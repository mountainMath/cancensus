<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>StatCan WDS • cancensus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="StatCan WDS">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107390160-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107390160-3');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cancensus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cancensus.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Making_maps_with_cancensus.html">Making maps with cancensus</a></li>
    <li><a class="dropdown-item" href="../articles/data_discovery.html">Data discovery</a></li>
    <li><a class="dropdown-item" href="../articles/intersecting_geometries.html">Finding intersecting geometries from custom data</a></li>
    <li><a class="dropdown-item" href="../articles/statcan_attribute_files.html">StatCan attribute files</a></li>
    <li><a class="dropdown-item" href="../articles/statcan_wds.html">StatCan WDS</a></li>
    <li><a class="dropdown-item" href="../articles/Dwellings_by_document_type_cross_tabulation.html">Additional datasets: Structural type of dwelling by document type</a></li>
    <li><a class="dropdown-item" href="../articles/Taxfiler_Data.html">Additional datasets: Annual T1FF taxfiler data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mountainMath/cancensus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>StatCan WDS</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mountainMath/cancensus/blob/HEAD/vignettes/statcan_wds.Rmd" class="external-link"><code>vignettes/statcan_wds.Rmd</code></a></small>
      <div class="d-none name"><code>statcan_wds.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mountainMath/cancensus" class="external-link">cancensus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Some census datasets have not been imported into CensusMapper, and
thus aren’t available via the <code><a href="../reference/get_census.html">get_census()</a></code> function. But
the data can be queried directly from the <a href="https://www12.statcan.gc.ca/wds-sdw/2021profile-profil2021-eng.cfm" class="external-link">Statistics
Canada Web Data Service for the 2021 census</a>, as well as geographic
boundary files.</p>
<div class="section level2">
<h2 id="word-of-caution">Word of caution<a class="anchor" aria-label="anchor" href="#word-of-caution"></a>
</h2>
<p>The StatCan census WDS is not a stable API, the meaning of the
internal identifiers used to query have changed in the past, and may
change again in the future. <strong>Use with extreme caution.</strong>
The same call may give different results at different points in time.
Moreover, the API server is sometimes unavailable.</p>
</div>
<div class="section level2">
<h2 id="ukrainians-by-federal-electoral-districts">Ukrainians by Federal Electoral Districts<a class="anchor" aria-label="anchor" href="#ukrainians-by-federal-electoral-districts"></a>
</h2>
<p>As an example we access the share of people with Ukrainian ethnic
origin at the Federal Electoral District level. Only the 2013 Federal
Electoral District boundaries are currently available from Statistics
Canada, since we want to map the data we will work with those in favour
of the updated 2023 boundaries. For this we need to specify the version
of the data we want to access, “1.3” for the 2013 boundaries vs the
latest “2.0” for the 2023 boundaries.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fed_version</span> <span class="op">=</span> <span class="st">"1.3"</span></span></code></pre></div>
<p>Next we need to find the StatCan Characteristic IDs for our
characteristic of interest. For this we download the metadata, extract
the characteristics, locate the base characteristic for ethnic origin
and the entry referencing “Ukrainian” that’s a descendant of the base
characteristic.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_statcan_wds_metadata.html">get_statcan_wds_metadata</a></span><span class="op">(</span><span class="st">"2021"</span>,<span class="st">"FED"</span>,version<span class="op">=</span><span class="va">fed_version</span><span class="op">)</span></span>
<span></span>
<span><span class="va">characteristics</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Codelist en`</span><span class="op">==</span><span class="st">"Characteristic"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">`Parent ID`</span><span class="op">)</span>,<span class="va">as.integer</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ethnic_base</span> <span class="op">&lt;-</span> <span class="va">characteristics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Total - Ethnic"</span>,<span class="va">en</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ukranian</span> <span class="op">&lt;-</span> <span class="va">characteristics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Ukrainian"</span>,<span class="va">en</span><span class="op">)</span>, <span class="va">`Parent ID`</span><span class="op">==</span><span class="va">ethnic_base</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">selected_characteristics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ethnic_base</span>,<span class="va">ukranian</span><span class="op">)</span></span>
<span></span>
<span><span class="va">selected_characteristics</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">en</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;      ID en                                                                      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>684 Total - Ethnic or cultural origin for the population in private househo…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>694 Ukrainian</span></span></code></pre></div>
<p>We can also get the geographic identifiers for the federal electoral
districts from the metadata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dguids</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Codelist ID`</span><span class="op">==</span><span class="st">"CL_GEO_FED"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_statcan_wds_data.html">get_statcan_wds_data</a></span><span class="op">(</span><span class="va">dguids</span>,members<span class="op">=</span><span class="va">selected_characteristics</span><span class="op">$</span><span class="va">ID</span>,</span>
<span>                             gender<span class="op">=</span><span class="st">"Total"</span>,version<span class="op">=</span><span class="va">fed_version</span><span class="op">)</span></span></code></pre></div>
<p>The data comes enriched with metadata to make working with it easier,
in particular the <code>CHARACTERISTIC_NAME</code> column contains plain
language names. Now we can transform the data to compute
percentages.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>DGUID<span class="op">=</span><span class="va">GEO_DESC</span>,Name<span class="op">=</span><span class="va">GEO_NAME</span>,name<span class="op">=</span><span class="va">CHARACTERISTIC_NAME</span>,value<span class="op">=</span><span class="va">OBS_VALUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Share<span class="op">=</span><span class="va">Ukrainian</span><span class="op">/</span><span class="va">`Total - Ethnic or cultural origin for the population in private households - 25% sample data`</span><span class="op">)</span></span></code></pre></div>
<p>Now we can visualize the data, here are the top 20 Federal Electoral
Districts by share of the population with Ukrainian heritage.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Share</span>,n<span class="op">=</span><span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">Name</span>,<span class="va">Share</span><span class="op">)</span>,x<span class="op">=</span><span class="va">Share</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>,fill<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Ukrainian ethnic origin"</span>,</span>
<span>       y<span class="op">=</span><span class="st">"Federal electoral district (2013 Represenation Order)"</span>,</span>
<span>       x<span class="op">=</span><span class="st">"Share of population in private households"</span>,</span>
<span>       caption<span class="op">=</span><span class="st">"StatCan Census 2021"</span><span class="op">)</span></span></code></pre></div>
<p><img src="statcan_wds_files/figure-html/unnamed-chunk-7-1.png" alt="Ukrainian ethnic origin" width="576"></p>
<p>To map the data we have to get the geographies.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fed_geos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_statcan_geographies.html">get_statcan_geographies</a></span><span class="op">(</span><span class="st">"2021"</span>,<span class="st">"FED"</span><span class="op">)</span></span></code></pre></div>
<p>With these we can join on our census data and map it.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fed_geos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">plot_data</span>,by<span class="op">=</span><span class="st">"DGUID"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Share</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Ukrainian ethnic origin by (2013) Federal Electoral District"</span>,</span>
<span>       fill<span class="op">=</span><span class="st">"Share of\npopulation"</span>,</span>
<span>       caption<span class="op">=</span><span class="st">"StatCan Census 2021"</span><span class="op">)</span></span></code></pre></div>
<p><img src="statcan_wds_files/figure-html/unnamed-chunk-9-1.png" alt="Ukrainian ethnic origin by (2013) Federal Electoral District" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mountainmath.ca" class="external-link">Jens von Bergmann</a>, <a href="https://dshkol.com" class="external-link">Dmitry Shkolnik</a>, Aaron Jacobs.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
